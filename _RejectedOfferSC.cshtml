@model GSTECommerceLibrary.Admin.Admin
@{
    var reasons = ViewBag.ReasonList as System.Data.DataTable;
}

<div class="container-fluid">

    <div class="row md-4">
        <div class="col-12">
            @*<h6 class="border-bottom pb-2">Offer Details</h6>*@
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <dl class="row">
                @*<dt class="col-sm-4">Offer Code:</dt>
                    <dd class="col-sm-8">@Model.OfferCode</dd>*@

                <dt class="col-sm-4">Offer Name:</dt>
                <dd class="col-sm-8">@Model.OfferName</dd>

                @*<dt class="col-sm-4">Product Code:</dt>
                    <dd class="col-sm-8">@Model.ProductCode</dd>*@

                <dt class="col-sm-4">Product Name:</dt>
                <dd class="col-sm-8">@Model.ProductName</dd>
            </dl>
        </div>

        <div class="col-md-6">
            <dl class="row">
                <dt class="col-sm-4">Start Date:</dt>
                <dd class="col-sm-8">
                    @(Model.OfferStartDate.HasValue ? Model.OfferStartDate.Value.ToString("dd-MMM-yyyy") : "")
                </dd>

                <dt class="col-sm-4">End Date:</dt>
                <dd class="col-sm-8">
                    @(Model.OfferEndDate.HasValue ? Model.OfferEndDate.Value.ToString("dd-MMM-yyyy") : "")
                </dd>

                <dt class="col-sm-4">Discount:</dt>
                <dd class="col-sm-8">@Model.OfferDiscountPercentage%</dd>
            </dl>
        </div>
    </div>

    <!-- Rejection Form Section -->
    <div class="row mt-4">
        <div class="col-12">
            @*<h3 class="border-bottom pb-2">Rejection Reason</h3>*@
        </div>
    </div>

    <form id="rejectForm">
        <input type="hidden" name="OfferCode" value="@Model.OfferCode" />

        <div class="form-group">
            <label>Select Rejection Reason:</label>
            <select class="form-control" name="ReasonId" required>
                <option value="">-- Select Reason --</option>
                @if (reasons != null)
                {
                    foreach (System.Data.DataRow row in reasons.Rows)
                    {
                        <option value="@row["ReasonId"]">@row["Reason"]</option>
                    }
                }
            </select>
        </div>

        <div class="form-group mt-3">
            <button type="submit" class="btn btn-danger">Submit Rejection</button>
            @*<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>*@
        </div>
    </form>
</div>

<script>
    $("#rejectForm").submit(function (e) {
        e.preventDefault();

        var form = $(this);

        Swal.fire({
            title: 'Confirm Rejection',
            text: "Are you sure you want to reject this offer?",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',       // 🔴 Reject button
            cancelButtonColor: '#3085d6',     // 🔵 Cancel button
            confirmButtonText: 'Yes, reject!',
            cancelButtonText: 'Cancel'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    type: "POST",
                    url: "/Admin/RejectOfferInsertSC",
                    data: form.serialize(),
                    success: function (res) {
                        if (res.success) {
                            Swal.fire({
                                icon: 'success',
                                title: 'Rejected!',
                                text: res.message || "Offer rejected successfully.",
                                confirmButtonColor: '#3085d6'
                            }).then(() => {
                                $("#rejectModal").modal('hide');
                                location.reload();
                            });
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: res.message || "Failed to reject offer.",
                                confirmButtonColor: '#3085d6'
                            });
                        }
                    },
                    error: function () {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Error occurred during rejection.',
                            confirmButtonColor: '#3085d6'
                        });
                    }
                });
            }
        });
    });

</script>
<link href="~/Content/Document/CSS/AddOfferSC.css" rel="stylesheet" />