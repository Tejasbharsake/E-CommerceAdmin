@model List<GSTECommerceLibrary.Admin.Admin>

@{
    ViewBag.Title = "Complaint Management SG";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Breadcrumb {
    <li class="breadcrumb-item active" aria-current="page">
        Complaint Management
    </li>
}
@{
    var summary = (GSTECommerceLibrary.Admin.Admin)ViewBag.Summary;
}



<!-- DataTables CSS -->
<link href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css" rel="stylesheet" />

<!-- DataTables Buttons CSS -->
<link href="https://cdn.datatables.net/buttons/2.2.3/css/buttons.bootstrap5.min.css" rel="stylesheet" />

<link href="~/Content/Document/CSS/ComplaintManagementSG.css" rel="stylesheet" />


<!-- Daterangepicker CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker@3.1/daterangepicker.css" />




<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-white bg-primary">
            <div class="card-body">
                <h5>Total Complaints</h5>
                <h3>@summary.Total</h3>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card text-white bg-warning">
            <div class="card-body">
                <h5>New</h5>
                <h3>@summary.NewComplaint</h3>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card text-white bg-info">
            <div class="card-body">
                <h5>In-Process</h5>
                <h3>@summary.InProcessComplaint</h3>
            </div>
        </div>

    </div>
    <div class="col-md-3">
        <div class="card text-white bg-success">
            <div class="card-body">
                <h5>Resolved</h5>
                <h3>@summary.ResolvedComplaint</h3>
            </div>
        </div>
    </div>
</div>

<section class="section">
    @*<div class="card">
        <div class="card-header">
            Complaint Management
        </div>*@
    <div class="card-body">

        <div class="controls-container d-flex align-items-center justify-content-between flex-wrap mb-3">
            <!-- Left side: Date Picker + Status Filter -->
            <div class="d-flex align-items-center gap-3 flex-wrap">
                <div class="d-flex align-items-center gap-2">
                    <label class="form-label fw-semibold mb-0">Date Range Picker:</label>
                    <input class="form-control input-daterange-datepicker" type="text" name="daterange" placeholder="Select Date Range" autocomplete="off" style="width: 250px;" />
                </div>

                <!-- Status Filter -->
                <div class="d-flex align-items-center gap-2" id="statusFilterContainer">
                    <!-- Status dropdown inserted dynamically by JS -->
                </div>
            </div>

            <!-- Middle: Selected Count -->
            <div>
                <span id="selectedCount" class="selected-count"></span>
            </div>

            <!-- Right side: Export Buttons -->
            <div id="exportButtons" class="d-flex gap-2"></div>
        </div>


        <div style="overflow: hidden;">
            <table class="table table-striped" id="table1">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" class="select-checkbox" id="selectAllCheckbox">
                        </th>
                        <th>Sr No</th>
                        <th>Customer Name</th>
                        <th>Issue Category</th>
                        <th>Registered Date</th>

                        <th>Mobile No</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>




                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        int srNo = 1;
                        foreach (var item in Model)
                        {
                            <tr data-complaint="@item.SupportTicketId">
                                <td>
                                    <input type="checkbox" class="select-checkbox row-checkbox">
                                </td>
                                <td>@srNo</td>
                                <td>@item.PartyName</td>
                                <td>@item.IssueCategory</td>
                                <td data-order="@item.RegisteredDate.ToString("yyyy-MM-dd")">
                                    @item.RegisteredDate.ToString("dd-MM-yyyy")
                                </td>
                                <td>@($"+91 {item.PartyMobile}")</td>

                                <td>
                                    <span class="badge
                                        @(item.Status == "Resolved" ? "bg-success" :
                                          item.Status == "In Process" ? "bg-info" :
                                          "bg-warning") text-white">
                                        @item.Status
                                    </span>
                                </td>
                                <td>
                                    @if (item.SupportTicketId > 0)
                                    {
                                        <button class="btn btn-sm "
                                                onclick="loadComplaintDetailsSG(@item.SupportTicketId)"
                                                title="View Complaint Details">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                    }
                                    else
                                    {
                                        <span class="text-muted">N/A</span>
                                    }
                                </td>
                            </tr>
                            srNo++;
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="8" class="text-center">No records found.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <!-- Modal -->
        <div class="modal fade" id="complaintModal" tabindex="-1" aria-labelledby="complaintModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header text-white" style="background: #2C3E50 ">
                        <h5 class="modal-title" id="complaintModalLabel">Complaint Details</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>

                    </div>
                    <div class="modal-body" id="complaintModalBody">

                    </div>
                </div>
            </div>
        </div>
    </div>
    @*</div>*@
</section>





<div class="position-fixed end-0 p-3" style="z-index: 11; top: 60px;">
    <div id="liveToast" class="toast align-items-center text-white bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                <span id="toastMessage"></span>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>



@section Scripts {
    <!-- Moment.js -->
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/min/moment.min.js"></script>

    <!-- Daterangepicker JS -->
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker@3.1/daterangepicker.min.js"></script>

    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>

    <!-- DataTables Buttons JS -->
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.bootstrap5.min.js"></script>

    <!-- Downloaded CDN -->
    <script src="~/Content/Document/CustomJS/buttons.print.min.js"></script>
    <script src="~/Content/Document/CustomJS/buttons.html5.min.js"></script>
    <script src="~/Content/Document/CustomJS/jszip.min.js"></script>
    <script src="~/Content/Document/CustomJS/pdfmake.min.js"></script>
    <script src="~/Content/Document/CustomJS/vfs_fonts.js"></script>

    <script>



        function showErrorToast(message) {
            $('#toastMessage').text(message);
            var toastEl = document.getElementById('liveToast');
            var toast = new bootstrap.Toast(toastEl);
            toast.show();
        }

        function showSuccessToast(message) {
            $('#toastMessage').text(message);
            $('#liveToast').removeClass('bg-danger').addClass('bg-success');
            var toastEl = document.getElementById('liveToast');
            var toast = new bootstrap.Toast(toastEl);
            toast.show();
        }



        let table;
        let selectedRows = new Set();




        $(document).ready(function ()
        {

            $('.input-daterange-datepicker').daterangepicker({
                opens: 'right',
                autoUpdateInput: false,
                locale: {
                    format: 'MM/DD/YYYY',
                    cancelLabel: 'Clear',
                    applyLabel: 'Apply'
                },
                startDate: moment().subtract(30, 'days'),
                endDate: moment()
            });


            $('.input-daterange-datepicker').on('apply.daterangepicker', function (ev, picker) {
                $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));
                filterByDate(picker.startDate, picker.endDate);
            });


            $('.input-daterange-datepicker').on('cancel.daterangepicker', function (ev, picker) {
                $(this).val('');
                clearDateFilter();
            });


            function filterByDate(startDate, endDate) {

                $.fn.dataTable.ext.search = [];


                $.fn.dataTable.ext.search.push(
                    function (settings, data, dataIndex) {
                        if (settings.nTable.id !== 'table1') return true;

                        var cell = table.row(dataIndex).nodes().to$().find('td:eq(4)');

                        var dateStr = cell.attr('data-order');

                        if (!dateStr || dateStr === '1900-01-01') return false;


                        var rowDate = moment(dateStr, 'YYYY-MM-DD');
                        return rowDate.isBetween(startDate, endDate, 'day', '[]');
                    }
                );
                table.draw();
            }


            function clearDateFilter() {
                $.fn.dataTable.ext.search.pop();
                table.draw();
            }


           /*let*/ table = $('#table1').DataTable({
              
               responsive: true,
               searching: true,
               paging: true,
               ordering: false,
               info: true,
               lengthChange: false,
               pageLength: 10,
               destroy: true,
               autoWidth: false,
               scrollX: false,
               lengthMenu: [5, 10, 25, 50, 100],


                drawCallback: function() {

                    var pageInfo = this.api().page.info();
                    this.api().column(1, {page:'current'}).nodes().each(function(cell, i) {
                        cell.innerHTML = pageInfo.start + i + 1;
                    });

                },
                language: {
                    search: "Search:",
                    searchPlaceholder: "Type to search"
                },
               dom: '<"row"<"col-sm-12 col-md-6 d-flex align-items-center"l><"col-sm-12 col-md-6"B>><"row"<"col-sm-12"f>><"row"<"col-sm-12"tr>><"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',
               buttons: [
                   {
                       extend: 'copy',
                       text: '<img src="/Content/Document/Image/Copy.png" style="width:16px; height:16px;">',
                       attr: { title: 'Copy to Clipboard' }, 
                     /*  className: 'buttons-copy',*/
                       action: function (e, dt, button, config) {
                           if ($('.row-checkbox:checked').length === 0) {
                               showErrorToast('Please select at least one row to export.');
                               return;
                           }
                           $.fn.dataTable.ext.buttons.copyHtml5.action.call(this, e, dt, button, config);
                       },
                       exportOptions: {
                           columns: ':not(:first-child, :last-child, :nth-last-child(2))',
                           rows: function (idx, data, node) {

                               return $(node).find('.row-checkbox').is(':checked');
                           },
                           format: {
                               body: function (data, row, column, node) {

                                   if (column === 0) {
                                       return row + 1;
                                   }
                                   const $td = $(node).closest('td');
                                   if ($td.is('[data-order]')) {
                                       return $td.text().trim();
                                   }
                                   return data;
                               }
                           }
                       }
                   },
                   {
                       extend: 'csv',
                       text: '<img src="/Content/Document/Image/CSV.png" style="width:16px; height:16px;">',
                       attr: { title: 'Export as CSV file' }, 
                       /*className: 'btn btn-success btn-sm',*/
                       action: function (e, dt, button, config) {
                           if ($('.row-checkbox:checked').length === 0) {
                               showErrorToast('Please select at least one row to export.');
                               return;
                           }
                           $.fn.dataTable.ext.buttons.csvHtml5.action.call(this, e, dt, button, config);
                       },
                       filename: 'Complaint_Management_' + new Date().toISOString().slice(0, 10),
                       exportOptions: {
                           columns: ':not(:first-child, :last-child, :nth-last-child(2))',
                           rows: function (idx, data, node) {
                               return $(node).find('.row-checkbox').is(':checked');
                           },
                           format: {
                               body: function (data, rowIdx, columnIdx, node) {
                                   // For date column (RegisteredDate)
                                   const $td = $(node).closest('td');
                                   if ($td.attr('data-order')) {
                                       return $td.text().trim() || data;
                                   }
                                   return data;
                               }
                           }
                       },
                       customize: function (csv, config) {
                           // Fix serial numbers in CSV
                           var lines = csv.split('\n');
                           var serialNumber = 1;

                           for (var i = 1; i < lines.length; i++) {
                               if (lines[i].trim() !== '') {
                                   var columns = lines[i].split(',');
                                   if (columns.length > 0) {
                                       columns[0] = serialNumber++;
                                       lines[i] = columns.join(',');
                                   }
                               }
                           }
                           return lines.join('\n');
                       }
                   },

                   {
                       extend: 'excel',
                       text: '<img src = "/Content/Document/Image/XLS.png" style="width:16px; height:16px;">',
                       attr: { title: 'Export as Excel file' }, 
                     /*  className: 'buttons-excel',*/
                       action: function (e, dt, button, config) {
                           if ($('.row-checkbox:checked').length === 0) {
                               showErrorToast('Please select at least one row to export.');
                               return;
                           }
                           $.fn.dataTable.ext.buttons.excelHtml5.action.call(this, e, dt, button, config);
                       },
                       filename: 'Complaint Management' + new Date().toISOString().slice(0, 10),
                       title: 'Complaint Management',
                       exportOptions: {
                           columns: ':not(:first-child, :last-child, :nth-last-child(2))',
                           rows: function (idx, data, node) {
                               return $(node).find('.row-checkbox').is(':checked');
                           },
                           format: {
                               body: function (data, row, column, node) {

                                   const $td = $(node).closest('td');
                                   if ($td.attr('data-order')) {
                                       const displayText = $td.text().trim();
                                       return displayText || data;
                                   }
                                   return data;
                               }
                           }
                       },
                       customize: function (xlsx) {
                           var sheet = xlsx.xl.worksheets['sheet1.xml'];
                           $('row c[r^="A"]', sheet).each(function (i) {
                               if (i === 1) $(this).find('v').text(1);
                               else if (i > 1) $(this).find('v').text(i - 1);
                           });
                       }
                   },
                   {
                       extend: 'pdf',
                       text: '<img src="/Content/Document/Image/PDFicon.png" style="width:16px; height:16px;">',
                       attr: { title: 'Export as PDF' }, 
                       /*className: 'buttons-pdf',*/
                       action: function (e, dt, button, config) {
                           // use selectedRows (works across pages)
                           if (selectedRows.size === 0) {
                               showErrorToast('Please select at least one row to export.');
                               return;
                           }
                           // pass DataTable instance to customize
                           config.customizeDataTable = dt;
                           $.fn.dataTable.ext.buttons.pdfHtml5.action.call(this, e, dt, button, config);
                       },
                       filename: 'Complaint Management_' + new Date().toISOString().slice(0, 10),
                       title: 'Complaint Management',
                       orientation: 'landscape',
                       pageSize: 'A4',
                       exportOptions: {
                           columns: ':not(:first-child, :last-child, :nth-last-child(2))',
                           // export rows according to selectedRows (works across pages)
                           rows: function (idx, data, node) {
                               if (selectedRows.size > 0) {
                                   var tr = $(node).closest('tr');
                                   var ticketId = tr.data('complaint');
                                   return selectedRows.has(ticketId);
                               }
                               return true;
                           },
                           format: {
                               body: function (data, row, column, node) {
                                   // If the original TD had a data-order attribute, return the displayed text
                                   // (this returns "dd-MM-yyyy" because your <td data-order="yyyy-MM-dd"> contains server-side formatted text)
                                   var $td = $(node).closest('td');
                                   if ($td.is('[data-order]')) {
                                       return $td.text().trim() || data;
                                   }
                                   // otherwise return original value (do NOT rely on hard numeric column indices)
                                   return data;
                               }
                           }
                       },
                       customize: function (doc, config) {
                           var dt = config.customizeDataTable;
                           doc.content.splice(0, 1); // remove default title

                           // total records from selectedRows (reliable across pages)
                           var totalRecords = selectedRows.size;

                           // header
                           doc.content.unshift({
                               margin: [0, 0, 0, 12],
                               table: {
                                   widths: ['*', '*', '*'],
                                   body: [
                                       [
                                           { text: '', border: [false, false, false, false] },
                                           { text: 'RahiShop', alignment: 'center', fontSize: 16, bold: true, border: [false, false, false, false] },
                                           { text: '', border: [false, false, false, false] }
                                       ],
                                       [
                                           { text: '', border: [false, false, false, false] },
                                           { text: 'Complaint Management', alignment: 'center', fontSize: 14, bold: true, border: [false, false, false, false] },
                                           { text: `Generated On: ${new Date().toLocaleString()} \nTotal Records: ${totalRecords}`, alignment: 'right', fontSize: 10, italics: true, border: [false, false, false, false] }
                                       ]
                                   ]
                               },
                               layout: 'noBorders'
                           });

                           // make table full width
                           var table = doc.content[1].table;
                           table.widths = Array(table.body[0].length).fill('*');

                           // header style
                           doc.styles.tableHeader.fillColor = '#007bff';
                           doc.styles.tableHeader.color = 'white';
                           doc.styles.tableHeader.alignment = 'center';
                           doc.styles.tableHeader.fontSize = 10;
                           doc.defaultStyle.fontSize = 9;

                           // sequential serial numbers (fix numbering after export)
                           var serial = 1;
                           doc.content[1].table.body.forEach(function (row, i) {
                               if (i > 0) { // skip header row
                                   row.forEach(function (cell, j) {
                                       if (j === 0) {
                                           cell.text = serial++;
                                           cell.alignment = 'center';
                                       } else {
                                           cell.alignment = 'center';
                                       }
                                   });
                               }
                           });
                       }
                   },

                   {
                       extend: 'print',
                       text: '<img src="/Content/Document/Image/Print.png" style="width:16px; height:16px;">',
                       attr: { title: 'Print' }, 
                      /* className: 'btn btn-primary btn-sm',*/
                       action: function (e, dt, button, config) {
                           if ($('.row-checkbox:checked').length === 0) {
                               showErrorToast('Please select at least one row to export.');
                               return;
                           }
                           $.fn.dataTable.ext.buttons.print.action.call(this, e, dt, button, config);
                       },
                       title: 'Complaint Management',
                       exportOptions: {
                           columns: ':not(:first-child, :last-child, :nth-last-child(2))',
                           rows: function (idx, data, node) {
                               return $(node).find('.row-checkbox').is(':checked');
                           },
                           format: {
                               body: function (data, rowIdx, columnIdx, node) {
                                   const $td = $(node).closest('td');
                                   if ($td.attr('data-order')) {
                                       return $td.text().trim() || data;
                                   }
                                   return data;
                               }
                           }
                       },
                       customize: function (win) {
                           $(win.document.body)
                               .css('font-size', '10pt')
                               .prepend('<h2 style="text-align:center;">Complaint Management</h2><p style="text-align:center;">Generated On: ' + new Date().toLocaleString() + '</p>');

                           var $table = $(win.document.body).find('table')
                               .addClass('compact')
                               .css('font-size', '9pt');

                           // Fix serial numbers in print
                           var serialNumber = 1;
                           $table.find('tbody tr').each(function () {
                               $(this).find('td:eq(0)').text(serialNumber++);
                           });
                       }
                   }
               ],
                columnDefs: [
                    {
                        targets: 0,
                        orderable: false,
                        searchable: false
                    },
                    {
                        targets: 1,
                        orderable: false,
                        searchable: false
                    },
                   {
                        targets: 4,
                        type: 'date',
                        render: function (data, type, row) {
                            if (type === 'display') {
                                return data === 'N/A' ? 'N/A' : moment(data, 'YYYY-MM-DD').format('D-M-YYYY');
                            }
                            return data;
                        }
                    },
                    {
                        targets: 6,
                        render: function (data, type, row) {
                            if (type === 'filter' || type === 'sort') {

                                return $(data).text().trim() || data;
                            }

                            return data;
                        }
                     }

               ],

               //initComplete: function () {
               //    var column = this.api().column(6);


               //    var filterWrapper = $('<div class="d-flex align-items-center"></div>');


               //    var label = $('<label class="me-2 fw-semibold mb-0">Status:</label>');


               //    var select = $(
               //        '<select class="form-select" style="width:auto">' +
               //        '<option value="">All Status</option>' +
               //        '</select>')
               //        .on('change', function () {
               //            var val = $.fn.dataTable.util.escapeRegex($(this).val());
               //            column.search(val ? '^' + val + '$' : '', true, false).draw();
               //        });


               //    filterWrapper.append(label).append(select).appendTo('.StausFilter');


               //    var statusValues = [];
               //    column.data().each(function (d, index) {

               //        var cleanValue = $(d).text().trim();
               //        if (cleanValue && cleanValue !== '' && statusValues.indexOf(cleanValue) === -1) {
               //            statusValues.push(cleanValue);
               //        }
               //    });


               //    statusValues.sort();
               //    statusValues.forEach(function (d) {
               //        select.append('<option value="' + d + '">' + d + '</option>');
               //    });


               //    setTimeout(function () {
               //        $('.dataTables_wrapper').css({
               //            'overflow': 'hidden',
               //            'overflow-x': 'hidden',
               //            'overflow-y': 'hidden'
               //        });
               //    }, 100);


               //}
               initComplete: function () {
                   var column = this.api().column(6);

                   // Create filter wrapper
                   var filterWrapper = $('<div class="d-flex align-items-center"></div>');

                   // Create label
                   var label = $('<label class="me-2 fw-semibold mb-0">Status:</label>');

                   // Create select dropdown
                   var select = $(
                       '<select class="form-select" style="width:auto">' +
                       '<option value="">All Status</option>' +
                       '</select>')
                       .on('change', function () {
                           var val = $.fn.dataTable.util.escapeRegex($(this).val());
                           column.search(val ? '^' + val + '$' : '', true, false).draw();
                       });

                   // Append to the new container instead of .StausFilter
                   filterWrapper.append(label).append(select).appendTo('#statusFilterContainer');

                   // Populate status options
                   var statusValues = [];
                   column.data().each(function (d, index) {
                       var cleanValue = $(d).text().trim();
                       if (cleanValue && cleanValue !== '' && statusValues.indexOf(cleanValue) === -1) {
                           statusValues.push(cleanValue);
                       }
                   });

                   statusValues.sort();
                   statusValues.forEach(function (d) {
                       select.append('<option value="' + d + '">' + d + '</option>');
                   });

                   setTimeout(function () {
                       $('.dataTables_wrapper').css({
                           'overflow': 'hidden',
                           'overflow-x': 'hidden',
                           'overflow-y': 'hidden'
                       });
                   }, 100);
               }


           });



            table.buttons().container().appendTo('#exportButtons');
            function forceTransparentButtons() {
                $('.dt-buttons button, .dt-buttons a').each(function () {

                    $(this).removeClass('btn-secondary btn-primary btn-success btn-info btn-warning btn-danger');


                    this.style.setProperty('background', 'transparent', 'important');
                    this.style.setProperty('background-color', 'transparent', 'important');
                    this.style.setProperty('background-image', 'none', 'important');
                    this.style.setProperty('border', '1px solid #0d6efd', 'important');
                    this.style.setProperty('border-radius', '4px', 'important');
                    this.style.setProperty('color', '#0d6efd', 'important');

                });
            }

            forceTransparentButtons();
            setTimeout(forceTransparentButtons, 100);
            setTimeout(forceTransparentButtons, 500);
            setTimeout(forceTransparentButtons, 1000);

            $('#selectAllCheckbox').on('change', function () {
                const isChecked = $(this).is(':checked');

                if (isChecked) {
                    table.rows().every(function () {
                        const rowNode = this.node();
                        const ticketId = $(rowNode).data('complaint');
                        selectedRows.add(ticketId);
                    });
                } else {
                    selectedRows.clear();
                }

                table.$('.row-checkbox').prop('checked', isChecked);
                updateRowStyles();
                updateSelectedCount();
            });



            $(document).on('change', '.row-checkbox', function () {
                const $row = $(this).closest('tr');
                const ticketId = $row.data('complaint');

                if ($(this).is(':checked')) {
                    selectedRows.add(ticketId);
                } else {
                    selectedRows.delete(ticketId);
                }

                updateRowStyles();
                updateSelectAllCheckbox();
          
            });


            function updateSelectAllCheckbox() {
                const totalRows = table.rows().count();
                const selectedCount = selectedRows.size;

                if (selectedCount === 0) {
                    $('#selectAllCheckbox').prop('indeterminate', false).prop('checked', false);
                } else if (selectedCount === totalRows) {
                    $('#selectAllCheckbox').prop('indeterminate', false).prop('checked', true);
                } else {
                    $('#selectAllCheckbox').prop('indeterminate', true);
                }
            }



            table.on('draw', function () {
                table.rows().every(function () {
                    const rowNode = this.node(); 
                    const ticketId = $(rowNode).data('complaint');
                    const $checkbox = $(rowNode).find('.row-checkbox');
                    $checkbox.prop('checked', selectedRows.has(ticketId));
                });

                updateSelectAllCheckbox();
            });


        });


        function loadComplaintDetailsSG(ticketId) {

            $.ajax({
                url: '@Url.Action("ComplaintDetailsSG", "Admin")',
                data: { id: ticketId },
                type: 'GET',
                success: function (html) {
                    $('#complaintModalBody').html(html);
                    $('#complaintModal').modal('show');

                },
                error: function (xhr, status, error) {
                    alert("Failed to load complaint details:\n" + xhr.status + " " + xhr.statusText + "\n" + xhr.responseText);
                }
            });
        }
    </script>
}